{% extends "::baseForAdmin.html.twig" %}

{% block title %}
    Liste des matieres
{% endblock %}
{% block script %}
    <script language="javascript">
        function loadToHidden(libMatiere) {
            $("#messagedeleteContainer").html("");
               $("#titleDeleteModal").html(libMatiere);
        }
        
        function loadUpdateForm(nomMatiere){
            $("#messageContainer").html("");
         $("#updateModalSpinner").show();
            $("#updateModalContainer").html("");
         $("#nomMatiereMaj").html(nomMatiere);
           $.ajax({
               method:"GET" ,
              url:"{{ path('updateFormMatiere') }}", 
               data : {"nomMatiere" : nomMatiere }, 
               success:function (response) {
                   $("#updateModalSpinner").hide();
                   $("#updateModalContainer").html(response);
               }

           }) ;





        }
        function voirInfoMatiere(libMatiere) {
            $("#matiere").html(libMatiere);
            $("#spanModalContainer").html("");
            $("#modalSpinner").show();
            console.log(libMatiere);
            var tableau = "<table class='table table-responsive' border='1' >";
            tableau += "<tr align='center' class='table-header'><td>Enseignant</td><td>Groupe</td></tr>";
            $.ajax({
                url: "{{ path('voirInfoMatiereAJAX') }}",
                data: {"libMatiere": libMatiere},
                method: "GET",
                success: function (response) {
                    response = JSON.parse(response);
                    console.log(response);
                    $.each(response.listMat, function (i, item) {
                        var line = "<tr align='center'><td>" + item.enseignant + "</td><td>" + item.groupe + "</td></tr>";
                        tableau += line;
                    });

                    tableau += "</table>";
                    console.log(tableau);
                    $("#modalSpinner").hide();
                    $("#spanModalContainer").fadeIn();
                    $("#spanModalContainer").html(tableau);
                }
            });


        }

        $("document").ready(function () {
          $("#btnMaj").click(function () {

              $("#messageContainer").html("");

              if($("#libMatiere").val()==""){
                  $("#messageContainer").html("<div class='alert alert-danger'> Veuillez remplir le champ ! </div>");

              }else {
                  $.ajax({
                      method: "GET",
                      url: "{{ path('updateLibelleMatiere') }}",
                      data: {"newlibMatiere": $("#libMatiere").val(), "oldlibMatiere": $("#nomMatiereMaj").html()},
                      success: function (response) {
                          if (response == "done") {
                              $("#messageContainer").html("<div class='alert alert-success'> Mise à jour avec succccesssss ! </div>");
                              window.location.assign("{{ path('listerMatieres') }}") ;
                          } else {
                              $("#messageContainer").html("<div class='alert alert-danger'> Who cares ! </div>");
                          }
                      }

                  });
              }




          });
          

          
          
        }) ;
        
        
        
        
    </script>


{% endblock %}

{% block mainContent %}

    <hr class="hr-4">


    <div class="col-xs-12">

        <div class="row">

            <table class="table table-responsive" align="center">
                <tr class="table-header" align="center">
                    <td>Libellé Matiere</td>
                    <td>Plus d'information</td>
                    <td>Opérations</td>
                </tr>
                {% for mat in listeMatieres %}
                    <tr align="center">
                        <td>{{ mat.libelleMatiere }}</td>
                        <td><input type="button" value="Voir information" data-toggle='modal' data-target='#myModal'
                                   class="btn btn-primary" onclick="voirInfoMatiere('{{ mat.libelleMatiere }}')"></td>

                        <td>

                            <button onclick="loadUpdateForm('{{ mat.libelleMatiere }}')" class="btn btn-xs btn-warning" data-toggle="modal" data-target="#modalUpdate">
                                <i class="ace-icon fa fa-pencil bigger-120"></i>
                                Modifier
                            </button>





                        </td>

                    </tr>

                {% endfor %}


            </table>


        </div>

        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" align="center"><span id="matiere"></span></h4>
                    </div>
                    <div class="modal-body" align="center">

                        <center><i class="ace-icon fa fa-spin fa-refresh blue bigger-300" id="modalSpinner"></i>
                        </center>
                        <div id="spanModalContainer">

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>

                    </div>

                </div>

            </div>
        </div>



        <div class="modal fade" id="modalUpdate" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" align="center"><span id="nomMatiereMaj"></span></h4>
                    </div>
                    <div class="modal-body" align="center">
                        <center><i class="ace-icon fa fa-spin fa-refresh blue bigger-300" id="updateModalSpinner"></i>
                        </center>
                        <div id="messageContainer"></div>
                        <div id="updateModalContainer">

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" id="btnMaj">Mettre à jour</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>

                    </div>

                </div>

            </div>
        </div>


    </div>


{% endblock %}