{% extends "::baseForEnseignant.html.twig" %}
{% block script %}
    <script language="JavaScript">
        $("document").ready(function () {


            $("#buttonChargerGroupes").click(function () {
                console.log("hey");
                console.log($("#firstForm").serialize());
                $.ajax({
                    url: "{{ path('chargerGroupesAJAX') }}",
                    method: "GET",
                    data: $("#firstForm").serialize(),
                    success: function (response) {

                        response = JSON.parse(response);
                        if (response.length == 0) {
                            $("#annee").css("border-color", "red");
                        } else {
                            console.log(response);
                            var myList = "<select name='selectGroupe' id='selectGroupe' >";

                            $.each(response, function (i, item) {

                                myList += "<option value='" + item.groupe.id + "|" + item.matiere.id + "'>" + item.groupe.nom_groupe + " " + item.groupe.num_groupe + " " + item.matiere.libelle_matiere + "</option>";

                            });
                            myList += "</select>";
                            myList += "<select id='trimestre' name='trimestre' style='margin-left: 15px'><option value='1'>Trimèstre 1 </option><option value='2'>Trimèstre 2 </option><option value='3'>Trimèstre 3 </option></select>";
                            $("#secondForm").html(myList);
                            $("#chargerClasseBtn").fadeIn();
                            $("#buttonChargerGroupes").attr("disabled", "disabled");
                        }
                    }
                });


            });
            $("#chargerClasseBtn").click(function () {
                $.ajax({
                    url: "{{ path('listerEleveParIDGroupeAJAX') }}",
                    data: $("#secondForm").serialize(),
                    method: "GET",
                    success: function (response) {
                        response = JSON.parse(response);
                        if (response.length == 0) {
                            var alert = "<div class='alert alert-warning'>Le groupe sélectionné est vide !</div>";

                            $("#noteSheetContainer").html(alert);
                            $("#noteSheetContainer").slideDown();

                        } else {

                            console.log(response);

                            var tableau = "<table border='1' style='margin-top: 25px' class='table table-responsive table-bordered' id='eleves'>" +
                                "<tr class='table-header'><td>Elève</td><td>Note 1</td><td>Note 2</td><td>Note 3</td></tr>";
                            $.each(response, function (i, item) {
                                var ligne = "<tr class='line-height-0'><td>" + item.nom_eleve + " " + item.prenom_eleve + "</td>" +
                                    "<td><input type='text' name='note" + item.id + "1'></td><td><input type='text' name='note" + item.id + "2'></td><td><input type='text' name='note" + item.id + "3'></td></tr>";
                                tableau += ligne;
                            });
                            tableau += "</table>";
                            $("#noteSheetContainer").html(tableau);
                            $("#saveData").fadeIn("fast");
                            $("#noteSheetContainer").slideDown();
                        }
                    }
                });

            });
            $("#saveData").click(function () {
                $.ajax({
                    method: "GET",
                    url: "{{ path('insererNotesAJAX') }}?" + $('#thirdForm').serialize() + "&anneeScolaire=" + $("#annee").val() + "&idEnseignant=" + $("#idEnseignant").val() + "&idMatiere=" + $("#selectGroupe").val() + "&trimestre=" + $("#trimestre").val(),
                    success: function (response) {
                        if (response.status == "inserted") {
                            var alert = "<div class='alert alert-success'>Insertion effectuer avec succees !</div>";
                            $("#saveData").fadeOut();
                            $("#noteSheetContainer").html(alert);
                        } else {
                            var alert = "<div class='alert alert-danger'>Problème d'insertion !</div>";
                            $("#saveData").fadeOut();
                            $("#noteSheetContainer").html(alert);
                        }

                    }
                });

            });
        });

    </script>
{% endblock %}
{% block title %}
    Insérer notes
{% endblock %}
{% block mainContent %}

    <div class="hr-4">
        <hr class="hr-6">
        <form id="firstForm">
            <input type="hidden" value="{{ app.session.get("user").id }}" name="idEnseignant" id="idEnseignant">
            <div class="col-xs-12" align="center">
                <div class="col-xs-12" align="center">

                    <select name="annee" id="annee">
                        <option>Année Scolaire</option>
                        {% for a in listAnnees %}
                            <option value="{{ a.id }}">{{ a.periode }}</option>
                        {% endfor %}
                    </select>

                </div>
            </div>
            <div align="center" class="col-xs-12" style="margin-top:25px">
                <input type="button" value="Charger les groupes" class="btn btn-primary" id="buttonChargerGroupes">
            </div>
        </form>
        <div class="col-xs-12" align="center" style="margin-top:25px">
            <form id="secondForm">

            </form>
            <input type='button' style='margin-left:10px;margin-top:25px; display: none' value='Charger la classe'
                   class='btn btn-primary' id='chargerClasseBtn'>
        </div>
        <hr class="hr-6">

        <form id="thirdForm">


            <div align="center" class="col-xs-12" style="margin-top:25px; display: none" id="noteSheetContainer">

            </div>
        </form>
        <div class="col-xs-12" align="center">
            <input value="Enregistrer" id="saveData" type="button" class="btn btn-primary" style="display: none">
        </div>
    </div>
    </div>


{% endblock %}